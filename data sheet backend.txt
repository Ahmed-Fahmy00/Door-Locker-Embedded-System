================================================================================
BACKEND (Control_ECU) - DATA SHEET
Door Locker Security System
TM4C123GH6PM LaunchPad
================================================================================

MICROCONTROLLER: TM4C123GH6PM (Tiva C Series)
CLOCK: 16 MHz (Main Oscillator) - DO NOT CHANGE (breaks UART baud rate)

================================================================================
PIN ASSIGNMENTS
================================================================================

J1     J3          J4    J2
+3.3V  VBUS        PF2   GND
PB5    GND         PF3   PB2
PB0    PD0         PB3   PE0
PB1    PD1         PC4   PF0
PE4    PD2         PC5   RST
PE5    PD3         PC6   PB7
PB4    PE1         PC7   PB6
PA5    PE2         PD6   PA4
PA6    PE3         PD7   PA3
PA7    PF1         PF4   PA2

UART1 (Communication with Frontend):
------------------------------------
  PB0 (J1) - UART1 RX    <- Connect to Frontend TX (PB1)
  PB1 (J1) - UART1 TX    -> Connect to Frontend RX (PB0)
  Baud Rate: 115200, 8N1

MOTOR (DC Motor via H-Bridge Driver):
-------------------------------------
  PC4 (J4) - Motor IN1   -> H-Bridge IN1 (Forward)
  PC5 (J4) - Motor IN2   -> H-Bridge IN2 (Reverse)
  
  Motor Control Logic:
    Forward (Door Open):  IN1=HIGH, IN2=LOW  (Green LED on)
    Reverse (Door Close): IN1=LOW,  IN2=HIGH (Red LED on)
    Stop:                 IN1=LOW,  IN2=LOW  (LEDs off)

  H-Bridge Connections:
    Motor+  -> H-Bridge OUT1
    Motor-  -> H-Bridge OUT2
    VCC     -> External 5V-12V (motor power)
    GND     -> Common Ground

STATUS LEDs (Onboard RGB):
--------------------------
  PF1 (J3) - Red LED     -> Door closing indicator
  PF2 (J4) - Blue LED    -> Debug/status indicator
  PF3 (J4) - Green LED   -> Door opening indicator

  LED Behavior:
    Green ON     = Motor forward (door opening)
    Red ON       = Motor reverse (door closing)
    Blue Blink   = Command received/response sent
    All OFF      = Idle/motor stopped

BUZZER (Active Buzzer):
-----------------------
  PA5 (J1) - Buzzer Signal -> Buzzer positive (long leg)
  GND      - Buzzer Ground -> Buzzer negative (short leg)
  
  Buzzer Activation:
    - Activated during lockout (3 wrong password attempts)
    - Duration: Same as configured timeout (5-30 seconds)

EEPROM (Internal):
------------------
  Password Offset:    0x00 (4 bytes, uint32_t)
  Timeout Offset:     0x04 (4 bytes, uint32_t)
  
  Default Values:
    Password: Set by user on first signup
    Timeout:  10 seconds (if EEPROM is blank/0xFFFFFFFF)

================================================================================
PHYSICAL WIRING LAYOUT
================================================================================

        LEFT SIDE (J1 + J3)              RIGHT SIDE (J4 + J2)
        ===================              ====================

J1:                                  J4:
  +3.3V  -> VCC for logic              PF2  (Blue LED - Debug)
  PB0    -> UART RX (from Frontend)    PF3  (Green LED - Door Open)
  PB1    -> UART TX (to Frontend)      PC4  -> Motor IN1 (Forward)
  PA5    -> Buzzer Signal              PC5  -> Motor IN2 (Reverse)

J3:                                  J2:
  GND    -> Common Ground              GND  -> Common Ground
  PF1    (Red LED - Door Close)

================================================================================
UART PROTOCOL
================================================================================

Request Format (Frontend -> Backend):
  [SOF=0x7E] [LEN] [CMD] [PAYLOAD...]

Response Format (Backend -> Frontend):
  [SOF=0xFE] [LEN] [CMD] [STATUS] [DATA...]

COMMAND HANDLERS:
-----------------

CMD 0x01 - INIT_PASSWORD
  Request:  [0x7E] [6] [0x01] [D1] [D2] [D3] [D4] [D5]
  Response: [0xFE] [2] [0x01] [STATUS]
  Action:   Store 5-digit password in EEPROM

CMD 0x02 - AUTH
  Request:  [0x7E] [7] [0x02] [MODE] [D1] [D2] [D3] [D4] [D5]
  Response: [0xFE] [2] [0x02] [STATUS]
  Modes:    0x00 = Check only, 0x01 = Open door
  Action:   Verify password, set pending_open_door flag if mode=1

CMD 0x03 - SET_TIMEOUT
  Request:  [0x7E] [2] [0x03] [SECONDS]
  Response: [0xFE] [2] [0x03] [STATUS]
  Range:    5-30 seconds
  Action:   Store timeout value in EEPROM

CMD 0x04 - CHANGE_PASSWORD
  Request:  [0x7E] [6] [0x04] [D1] [D2] [D3] [D4] [D5]
  Response: [0xFE] [2] [0x04] [STATUS]
  Action:   Update password in EEPROM

CMD 0x05 - GET_TIMEOUT
  Request:  [0x7E] [1] [0x05]
  Response: [0xFE] [3] [0x05] [STATUS] [TIMEOUT_VALUE]
  Action:   If pending_open_door: return timeout (no buzzer)
            Else: return timeout AND activate buzzer (lockout)

CMD 0x06 - CLOSE_DOOR
  Request:  [0x7E] [1] [0x06]
  Response: [0xFE] [2] [0x06] [STATUS]
  Action:   Respond immediately, then motor REVERSE 3 seconds

CMD 0x07 - OPEN_DOOR
  Request:  [0x7E] [1] [0x07]
  Response: [0xFE] [2] [0x07] [STATUS]
  Action:   Respond immediately, then motor FORWARD 3 seconds

STATUS CODES:
-------------
  0x00 - UART_STATUS_OK        Success
  0x01 - UART_STATUS_ERROR     General error
  0x02 - UART_STATUS_AUTH_FAIL Wrong password

================================================================================
MOTOR OPERATION SEQUENCE
================================================================================

DOOR OPEN SEQUENCE:
  1. Frontend sends CMD_OPEN_DOOR
  2. Backend responds immediately with STATUS_OK
  3. Backend runs motor FORWARD for 3 seconds
  4. Green LED (PF3) ON during forward
  5. Motor stops, Green LED OFF

DOOR CLOSE SEQUENCE:
  1. Frontend sends CMD_CLOSE_DOOR
  2. Backend responds immediately with STATUS_OK
  3. Backend runs motor REVERSE for 3 seconds
  4. Red LED (PF1) ON during reverse
  5. Motor stops, Red LED OFF

COMPLETE DOOR CYCLE:
  AUTH (mode=1) -> GET_TIMEOUT -> OPEN_DOOR -> [countdown] -> CLOSE_DOOR

================================================================================
LOCKOUT OPERATION
================================================================================

TRIGGER: 3 consecutive wrong password attempts (tracked by frontend)

SEQUENCE:
  1. Frontend sends CMD_GET_TIMEOUT (without prior AUTH mode=1)
  2. Backend detects no pending_open_door flag
  3. Backend activates buzzer for timeout duration
  4. Backend responds with timeout value
  5. Frontend shows lockout countdown
  6. Buzzer stops after timeout expires

================================================================================
DEBUG LED PATTERNS (Blue LED - PF2)
================================================================================

  1 blink  = System starting / Command received
  2 blinks = Response sent successfully
  3 blinks = Error response sent
  Solid ON = Processing command

================================================================================
CONNECTIONS CHECKLIST
================================================================================

[ ] UART (Cross-connect with Frontend)
    [ ] PB0 (Backend RX) <-> PB1 (Frontend TX)
    [ ] PB1 (Backend TX) <-> PB0 (Frontend RX)
    [ ] GND <-> GND (CRITICAL: common ground!)

[ ] Motor (via H-Bridge)
    [ ] PC4 -> H-Bridge IN1
    [ ] PC5 -> H-Bridge IN2
    [ ] H-Bridge OUT1 -> Motor+
    [ ] H-Bridge OUT2 -> Motor-
    [ ] H-Bridge VCC -> External motor power (5-12V)
    [ ] H-Bridge GND -> Common Ground
    [ ] H-Bridge Logic VCC -> 3.3V (if required)

[ ] Buzzer
    [ ] PA5 -> Buzzer + (long leg)
    [ ] GND -> Buzzer - (short leg)

[ ] Power
    [ ] LaunchPad powered via USB or external
    [ ] Motor power separate from logic (if high current)
    [ ] Common ground between all components

================================================================================
TIMING SPECIFICATIONS
================================================================================

Motor Operations:
  Door Open Duration:   3 seconds (forward)
  Door Close Duration:  3 seconds (reverse)

UART:
  Baud Rate:           115200 bps
  Response Time:       < 10 ms (for non-motor commands)

EEPROM:
  Write Time:          ~6 ms per word
  Read Time:           Immediate

Buzzer:
  Lockout Duration:    5-30 seconds (configurable)

================================================================================
MEMORY MAP
================================================================================

EEPROM Layout:
  0x0000 - 0x0003: Password (uint32_t, 5 digits as number)
  0x0004 - 0x0007: Timeout (uint32_t, seconds)
  0x0008 - 0x000B: (Reserved for future use)

RAM Variables:
  pending_open_door:   Flag set by AUTH mode=1, cleared by GET_TIMEOUT
  packet_ready:        Flag set by ISR when packet received
  rx_state:            UART receive state machine

================================================================================
FILE STRUCTURE
================================================================================

backend/
├── main.c                 - Main loop, system init
├── uart_handler.c         - UART protocol, command dispatch
├── uart_handler.h         - Command/status definitions
├── eeprom_handler.c       - Password & timeout EEPROM access
├── eeprom_handler.h       - EEPROM offsets, function prototypes
├── components/
│   ├── motor.c            - Motor GPIO, forward/reverse/stop
│   ├── motor.h            - Motor state enum, function prototypes
│   ├── buzzer.c           - Buzzer GPIO control
│   ├── buzzer.h           - Buzzer function prototypes
│   ├── timeout.c          - Timeout activation (buzzer)
│   ├── timeout.h          - Timeout function prototypes
│   ├── timer.c            - Timer utilities
│   └── timer.h            - Timer function prototypes
├── lib/                   - TivaWare library files
├── MCAL/                  - Low-level drivers
└── data sheet backend.txt - This file

================================================================================
